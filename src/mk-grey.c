#include <stdio.h>
#include <stdlib.h>


#include "qap-utils.h"

/*
 * created with
 * echo -ne '{0, 0, 0'; sed -n -e 's!^ *[0-9]\+ \+\([0-9]\+\).*!, \1!p' Data/grey8_8.sols | tr -d '\r\n'; echo '};'
 */

int bks8[64] = 
{0, 0, 0, 31250, 62500, 154852, 256250, 389724, 525000, 749258, 980266, 1237980, 1516776, 1855928, 2202766, 2583008, 2970000, 3564592, 4161608, 4783958, 5408928, 6095226, 6813638, 7564038, 8330584, 9171006, 10013230, 10891152, 11770876, 12715324, 13666022, 14635470, 15611168, 17022184, 18439450, 19875466, 21317732, 22824722, 24333514, 25878004, 27424296, 29044464, 30680778, 32347022, 34049496, 35811240, 37575604, 39363746, 41157424, 43157146, 45163618, 47203494, 49251056, 51358974, 53487974, 55643680, 57806136, 60057574, 62310814, 64596130, 66890492, 69245956, 71607670, 73988134};



int bks16[256] = 
{0, 0, 0, 7810, 15620, 38072, 63508, 97178, 131240, 183744, 242266, 304722, 368952, 457504, 547522, 644036, 742480, 878888, 1012990, 1157992, 1305744, 1466210, 1637794, 1820052, 2010846, 2216842, 2427576, 2647052, 2871704, 3122510, 3373854, 3646344, 3899744, 4230950, 4561906, 4892662, 5222618, 5565236, 5909202, 6262248, 6613472, 7002794, 7390662, 7802078, 8220514, 8680850, 9139788, 9594404, 10070960, 10536686, 11024614, 11526712, 12045722, 12578842, 13101338, 13680094, 14279848, 14859758, 15435898, 15981086, 16582386, 17202312, 17827460, 18435790, 19065968, 19863136, 20655396, 21556834, 22383044, 23224540, 24068286, 24920050, 25772264, 26646734, 27522890, 28405722, 29293816, 30197008, 31102110, 32015564, 32930704, 33897392, 34859172, 35839166, 36814068, 37750014, 38702396, 39749590, 40818040, 41846548, 42875506, 43913382, 44951708, 45975512, 47021390, 48110512, 49182368, 50344050, 51486642, 52660116, 53838088, 55014262, 56208480, 57417112, 58629516, 59854744, 61084902, 62324634, 63582416, 64851966, 66120830, 67392724, 68666416, 69984758, 71304194, 72630764, 73962220, 75307424, 76657014, 78015914, 79375832, 80756852, 82138768, 83528554, 84920540, 86327812, 87736646, 89150166, 90565248};


int
main(int argc, char *argv[])
{
  QAPInfo qi;
  char *file_name;
  int i, j;
  int n;
  int sz;
  int m;


  if (argc == 3)
    {
      sz = atoi(argv[1]);
      m = atoi(argv[2]);
    }

  if (argc != 3  || (sz != 8 && sz != 16) || m < 3 || m >= sz * sz)
    {
      printf("Usage %s SIZE DENSITY    SIZE=8 or 16   DENSITY in 3..SIZE*SIZE-1\n", argv[0]);
      return 1;
    }


  file_name = (sz == 8) ? "grey8_8-base.dat" : "grey16_16-base.dat";

  qi = QAP_Load_Problem(file_name, 0);
  n = qi->size;

  int max = 0;

  for (i = 0; i < n; i++)
    for(j = 0; j < n; j++)
      {
	qi->a[i][j] = (i < m && j < m) ? 1 : 0;

        if (qi->b[i][j] > max)
          max = qi->b[i][j];
      }

  int nb10 = 0;
  int max10 = 1;

  while(max >= max10)
    {
      nb10++;
      max10 *= 10;
    }


  /*  qi->opt = 0;
      qi->bound = 0;
  */
  qi->bks = (sz == 8) ? bks8[m] : bks16[m];

  printf("%d %d %d\n", qi->size, qi->opt, qi->bks);
  for(i = 0; i < n; i++)
    {
      int c = '\n';
      for (j = 0; j < n; j++)
        {
          printf("%c%d", c, qi->a[i][j]);
          c = ' ';
        }
    }

  printf("\n");
  for(i = 0; i < n; i++)
    {
      int c = '\n';
      for (j = 0; j < n; j++)
        {
          printf("%c%*d", c, nb10, qi->b[i][j]);
          c = ' ';
        }
    }
  printf("\n");

  return 0;
}
